<section class="productos-crud-container">
  <h1 class="titulo">üõçÔ∏è Gesti√≥n de Productos</h1>

  <!-- Mensaje -->
  <div *ngIf="mensaje" class="mensaje">
    {{ mensaje }}
  </div>

  <!-- Formulario de creaci√≥n / edici√≥n -->
  <form (ngSubmit)="guardarProducto()" class="formulario" enctype="multipart/form-data">
    <h3>{{ productoSeleccionado ? '‚úèÔ∏è Editar Producto' : '‚ûï Nuevo Producto' }}</h3>

    <div class="grid">
      <!-- Nombre -->
      <div class="campo">
        <label>Nombre *</label>
        <input [(ngModel)]="nuevoProducto.nombre" name="nombre" required />
      </div>

      <!-- Precio -->
      <div class="campo">
        <label>Precio *</label>
        <input type="number" [(ngModel)]="nuevoProducto.precio" name="precio" required />
      </div>

      <!-- Marca -->
      <div class="campo">
        <label>Marca</label>
        <input [(ngModel)]="nuevoProducto.marca" name="marca" />
      </div>

      <!-- Stock Actual -->
      <div class="campo">
        <label>Stock Actual *</label>
        <input
          type="number"
          [(ngModel)]="nuevoProducto.stockActual"
          name="stockActual"
          required
          min="0"
        />
      </div>

      <!-- Stock M√≠nimo -->
      <div class="campo">
        <label>Stock M√≠nimo *</label>
        <input
          type="number"
          [(ngModel)]="nuevoProducto.stockMinimo"
          name="stockMinimo"
          required
          min="0"
        />
      </div>

      <!-- Estado -->
      <div class="campo">
        <label>Estado *</label>
        <select [(ngModel)]="nuevoProducto.estado" name="estado" required>
          <option value="ACTIVO">Activo</option>
          <option value="INACTIVO">Inactivo</option>
        </select>
      </div>

      <!-- Categor√≠a -->
      <div class="campo">
        <label>Categor√≠a *</label>
        <select [(ngModel)]="nuevoProducto.categoriaId" name="categoriaId" required>
          <option value="">Seleccione una categor√≠a</option>
          <option *ngFor="let c of categorias" [value]="c.id">{{ c.nombre }}</option>
        </select>
      </div>

      <!-- Proveedor -->
      <div class="campo">
        <label>Proveedor *</label>
        <select [(ngModel)]="nuevoProducto.proveedorId" name="proveedorId" required>
          <option value="">Seleccione un proveedor</option>
          <option *ngFor="let p of proveedores" [value]="p.id">{{ p.nombre }}</option>
        </select>
      </div>

      <!-- Descripci√≥n -->
      <div class="campo full">
        <label>Descripci√≥n</label>
        <textarea [(ngModel)]="nuevoProducto.descripcion" name="descripcion"></textarea>
      </div>

      <!-- Imagen -->
      <div class="campo full">
        <label>Imagen del Producto</label>
        <input type="file" (change)="onFileSelected($event)" accept="image/*" />
        <div class="vista-previa" *ngIf="vistaPrevia">
          <p>Vista previa:</p>
          <img [src]="vistaPrevia" alt="Vista previa de imagen" />
        </div>
      </div>
    </div>

    <!-- Botones de acci√≥n -->
    <div class="acciones">
      <button type="submit" class="btn-guardar">
        {{ productoSeleccionado ? 'Actualizar' : 'Guardar' }}
      </button>
      <button type="button" class="btn-cancelar" (click)="resetFormulario()">Cancelar</button>
    </div>
  </form>

  <hr />

  <!-- Tabla de productos -->
  <div *ngIf="!cargando; else cargandoTpl">
    <table class="tabla">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Descripci√≥n</th>
          <th>Marca</th>
          <th>Precio</th>
          <th>Categor√≠a</th>
          <th>Proveedor</th>
          <!-- <th>Stock (Actual / M√≠nimo)</th> -->
          <!-- <th>Estado</th> -->
          <th>Imagen</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let p of productos">
          <td>{{ p.id }}</td>
          <td>{{ p.nombre }}</td>
          <td>{{ p.descripcion }}</td>
          <td>{{ p.marca }}</td>
          <td>${{ p.precio | number: '1.0-2' }}</td>
          <td>{{ p.categoria }}</td>
          <td>{{ p.proveedor }}</td>

          <!-- Stock -->
          <!-- <td>
            {{ p.stockActual || 0 }}
            <span class="min-stock">/ min: {{ p.stockMinimo || 0 }}</span>
          </td> -->

          <!-- Estado -->
          <!-- <td>
            <span
              [ngClass]="p.estado === 'activo' ? 'estado-activo' : 'estado-inactivo'"
            >
              {{ p.estado | titlecase }}
            </span>
          </td> -->

          <!-- Imagen -->
          <td>
            <img
              *ngIf="p.imagenUrl"
              [src]="'http://localhost:8080' + p.imagenUrl"
              alt="Imagen del producto"
              width="70"
              height="70"
              style="object-fit: cover; border-radius: 8px; box-shadow: 0 0 4px rgba(0, 0, 0, 0.2);"
            />
          </td>

          <!-- Acciones -->
          <td>
            <button class="btn-editar" (click)="editar(p)">‚úèÔ∏è</button>
            <button class="btn-eliminar" (click)="eliminar(p.id)">üóëÔ∏è</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Estado de carga -->
  <ng-template #cargandoTpl>
    <p class="cargando">‚è≥ Cargando productos...</p>
  </ng-template>
</section>
